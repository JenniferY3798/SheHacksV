$(document).ready(function() {
  $.ajax({
    type: "GET",
    url: "GHG-emissions-by-life-cycle-stage-OurWorldinData-upload.csv",
    dataType: "csv",
    success: function(data) {
      extractData(data);
    }
  });
});

var co2Data = extractData(
  "GHG-emissions-by-life-cycle-stage-OurWorldinData-upload.csv"
);

function extractData(fileName) {
  var allLines = fileName.split(/\r\n|\n/);

  for (var i = 1; i < allLines.length; i++) {
    var data = allLines[i].split(",");

    if (data.length == allLines[0].length) {
      var co2Data = {};
      for (var j = 0; j < allLines[0].Length; j++) {
        co2Data[data[j]] = data[allLines[0].length - 1];
      }
    }
  }
  alert(co2Data);
  return co2Data;
}

function calculateScoreMeal(meal) {
  var score = 0;
  for (var key in meal) {
    score = score + calculateScoreFood(key, meal[key]);
  }
  score = 100 - score;
  if (score < 0) {
    score = 0;
  }
  document.getElementById("score").innerHTML = score;
}

function calculateScoreFood(food, grams) {
  var score = 0;
  var kilograms = grams / 1000;
  score = kilograms * co2Data[food];
  return score;
}

function highestScore(scores) {
  var highestScore = 0;
  var winners = [''];
  for (var key in scores){
    if (scores[key] > highestScore) {
      highestScore = scores[key];
      winners = [key];
    }
    else if (scores[key] == highestScore) {
      winners.push(key);
    }
  }
  return winners, highestScore;
}

function leaderboard(scores) {
  var temp = {};
  var leaders = [];
  for (var i = 0; i < scores.length; i++) {
    var winners, highest = highestScore(scores)
    for (var j = 0; j < winners.length; j++)
      {
        temp[winners[j]] = highest;
        delete scores[winners[j]];
        leaders.push(winners[j] + ', ' + highest);       
      }
  }
  scores = temp;
  document.getElementById("leaders").innerHTML = leaders;
}

//calculate carbon emission per ingredient listed
function calcuCarbon(){
  var ingredient = document.getElementById("set_ingredient").value;
  var carbonEmissionPerKg = co2Data[ingredient];
  var ingredientMass = document.getElementById("mass").value;
  var carbonEmissionItem = carbonEmissionPerKg/1000 * ingredientMass;
  document.getElementById("carbon").innerHTML = carbonEmissionItem;
}

//Go to Top Button
var mybutton;
mybutton = document.getElementById("myBtn");

window.onscroll = function() {
  scrollFunction();
};

function scrollFunction() {
  if (document.body.scrollTop > 10 || document.documentElement.scrollTop > 10) {
    mybutton.style.display = "block";
  } else {
    mybutton.style.display = "none";
  }
}

function topFunction() {
  document.body.scrollTop = 0; // For Safari
  document.documentElement.scrollTop = 0; // For Chrome, Firefox, IE and Opera
}

